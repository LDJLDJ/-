### 有关路由选择协议的几个基本概念

-------------------------------
1、理想的路由算法：
（1）算法必须是正确和完整的  
（2）算法在计算上应简单  
（3）算法应能适应通信量和网络拓扑的变化  
（4）算法应具有稳定性  
（5）算法应是公平的  
（6）算法应是最佳的  

通过调制网络的通信量或拓扑自适应变化划分路由算法可分为两类：  
静态路由选择策略：也叫非自适应路由选择，简单开销小，不能适应网络状态的变化。  
动态路由选择策略：也叫自适应路由选择，能较好适应网络状态变，实现复杂，开销较大。  

2、分层次的路由选择协议  
原因：  
（1）因特网的规模非常大，如果所有路由器知道所有网络怎么到达，开销非常大。  
（2）许多单位不愿意外界了解本部门的网络布局和路由选择协议等等。  
因此：  
因特网将整个互联网划分为许多个**自治系统**，记为AS。  
尽管一个AS使用多种内部路由选择协议和度量，但一个AS对于其他AS来说，是单一和一致的路由选择策略。  
AS内部网关协议（RIP和OSPF协议）  
AS之间网关协议（BGP）

<img src="./imgs/自治系统和内部网关协议、外部网关协议.png" width="800" height="400"  alt="自治系统和内部网关协议、外部网关协议" >

### 内部网关协议RIP

------------------
RIP是一种分布式的基于距离向量的路由选择协议。  
RIP 协议要求网络中的每一个路由器都要维护从它自己到其他每一个目的网络的距离记录。  
RIP允许一条路径具有最多只能包含15个路由，因此距离等于16的不可到达。使用与小型互联网。  

```
RIP 协议的三个要点
仅和相邻路由器交换信息。 
交换的信息是当前本路由器所知道的全部信息，即自己的路由表。 
按固定的时间间隔交换路由信息，例如，每隔 30 秒。 
```

距离算法：  
路由器每隔大约30s向所有相邻路由器发送路由更新报文，并对每一个相邻路由器发送过来的路由器更新报文。  
步骤：  
（1）先修改路由X传来的RIP报文中的所有项目：把“下一跳”字段中的地址都改为 X，并把所有的“距离”字段的值加 1。即到目的网络N，距离d，下一跳路由为X  
（假设收到路由X传来的RIP报文中写，{NET2，3，Y}（即路由X到达N通过X的下一跳路由Y需要距离3），则我经过我的下一跳路由X到达N为{Net2，4，X}）
（2）对修改后的路由更新报文的每一个项目，进行以下步骤：  
1、若我的路由表中没有到达网络N的信息，则更新路由表新增{Net2，4，X}，否则查看目的网络N的表项的下一跳路由器地址。  
2、若下一跳路由器地址是X，则把{Net2，4，X}更新路由表，（不管原来路由表中项目为{Net2，3，X}还是{Net2，5，X}都要更新，以最新消息为准），  
否则（即目的地址N的下一跳不是X）
3、若收到的项目中距离小于d，则进行更新，否则不更新
（3）超过180s，则设置距离为16，若再过一段时间还是没收到则路由表删除该项目。  
（4）若路由表没发生变化，向所有相邻路由器发送路由更新报文。  
（5）返回。  

RIP协议让互联网中的所有路由器都和自己的相邻路由器不断交换路由信息，并不断更新其路由表，使得从每一个路由器到每一个目的网络的路由都是最短的（即跳数最少）。

虽然所有的路由器最终都拥有了整个自治系统的全局路由信息，但由于每一个路由器的位置不同，它们的路由表当然也应当是不同的。  

RIP坏消息传播得慢：  

<img src="./imgs/坏消息传播得慢正常情况.png" width="800" height="400"  alt="坏消息传播得慢正常情况" >

<img src="./imgs/坏消息传播得慢非正常情况1.png" width="800" height="400"  alt="坏消息传播得慢非正常情况1" >

<img src="./imgs/坏消息传播得慢非正常情况2.png" width="800" height="400"  alt="坏消息传播得慢非正常情况2" >

不断循环，知道距离到达16。  




